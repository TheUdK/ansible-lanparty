---
- name: lxc | Install lxc-dev
  apt:
    name: "{{ item }}"
    update_cache: yes
    cache_valid_time: "{{ apt_cache_valid | default('86400') }}"
    default_release: testing
  with_items:
    - lxc-dev
    - lxc

- name: lxc | Install Dependencies
  apt:
    name: "{{ item }}"
    update_cache: yes
    cache_valid_time: "{{ apt_cache_valid | default('86400') }}"
    default_release: testing
  with_items:
    - python-pip
    - python-dev

- name: lxc | Debian bug 808205 workaround (gcc >=5.1)
  apt:
    name: gcc
    default_release: testing
    state: latest

- name: lxc | Unit w/ OVS Dependency
  template:
    src: lxc.unit.j2
    dest: /etc/systemd/system/lxc.service
  notify: reload daemons

- meta: flush_handlers

- name: lxc | Install OVS scripts
  template:
    src: "{{ item }}.j2"
    dest: "/etc/lxc/{{ item }}"
    mode: 0755
  with_items:
    - ovs-up
    - ovs-down

- name: lxc | Python Bindings
  pip:
    executable: pip2
    name: lxc-python2

- name: lxc | Enable LXC Autostart
  service:
    name: lxc
    enabled: true
