---
- name: Netfilter Management Packages
  apt:
    name: "{{ item }}"
  with_items:
    [ 'iptables', 'iptables-persistent', 'conntrack',
      'conntrackd', 'netstat-nat', 'iptstate', 'ipset' ]
  tags: [ 'packages' ]

- name: Install | Remove custom netfilter-sysctl
  file:
    path: /etc/init.d/netfilter-sysctl
    state: absent

- name: Install | Custom netfilter-sysctl service
  service:
    name: netfilter-sysctl
    state: stopped
    enabled: false

- name: Install | Netfilter unit w/ sysctl reload
  template:
    src: sysctl-unit.j2
    dest: /etc/systemd/system/netfilter-persistent.service
  notify: reload daemons

- name: Install | Custom netfilter-sysctl service
  service:
    name: netfilter-persistent
    state: started
    enabled: true

- name: Install | Runtime Disable RP Filter
  sysctl:
    name: net.ipv4.conf.all.rp_filter
    value: 0
    sysctl_set: yes
    reload: yes

- name: Install | Runtime Log Martians
  sysctl:
    name: net.ipv4.conf.all.log_martians
    value: 1
    sysctl_set: yes
    reload: yes
